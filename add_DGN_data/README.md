# Various scripts to get DGN data incorporated into DrosEU, DrosRTEC data

## Description
>

## File structure set up

## Parse DGN data ###
  ### 0. Download all DGN data
  > Needs a tab delimited file with jobID, prefix, path to DGN bz2 file: DEST/add_DGN_data/dgn.list <br/>
  > Note that job 4 will fail. Why? Because 4 is the fourth line on DGN website for the DSPR. I don't think that we need to include that one.<br/>
  > RUN: `sbatch --array=1-8 /scratch/aob2x/dest/DEST/add_DGN_data/downloadDGN.sh`<br/>
  > OUT: /scratch/aob2x/dest/dgn/rawData<br/>

  ### 1. Unpack
  > Each tarball is a bit different so unpack script plays differently for each 1-8 (minus 4), from above. <br/>
  > `sbatch --array=1-8 /scratch/aob2x/dest/DEST/add_DGN_data/unpack.sh` <br/>
  >
  ~~> These are only for debugging: <br/> ~~
  ~~> DPGP2 RUN & DONE: `sbatch --array=1 /scratch/aob2x/dest/DEST/add_DGN_data/unpack.sh` <br/> ~~
  ~~> DPGP3 RUN & DONE: `sbatch --array=2 /scratch/aob2x/dest/DEST/add_DGN_data/unpack.sh` <br/> ~~
  ~~> DGRP RUN & DONE: `sbatch --array=3 /scratch/aob2x/dest/DEST/add_DGN_data/unpack.sh` <br/> ~~
  ~~> CLARK RUN & DONE: `sbatch --array=5 /scratch/aob2x/dest/DEST/add_DGN_data/unpack.sh` <br/> ~~
  ~~> NUZHDIN RUN & DONE: `sbatch --array=6 /scratch/aob2x/dest/DEST/add_DGN_data/unpack.sh` <br/> ~~
  ~~> POOL RUN: `sbatch --array=7 /scratch/aob2x/dest/DEST/add_DGN_data/unpack.sh` <br/> ~~
  ~~> SIMULANS RUN & DONE: `sbatch --array=8 /scratch/aob2x/dest/DEST/add_DGN_data/unpack.sh` <br/> ~~
  ~~> OUT: /scratch/aob2x/dest/dgn/wideData/<br/> ~~

  ### 2. Wide to long
  > should be 4725 jobs <br/>
  > RUN: `cd /scratch/aob2x/dest/dgn/wideData/; ls * | tr '\t' '\n' | awk '{print NR"\t"$0}' > /scratch/aob2x/dest/dgn/dgn_wideFiles.delim` <br/>
  > RUN: `sbatch --array=1-$( tail -n1 /scratch/aob2x/dest/dgn/dgn_wideFiles.delim | cut -f1 ) /scratch/aob2x/dest/DEST/add_DGN_data/wide2long.sh` <br/>
  > A quick check to make sure things look good:
  > `w2l_check.R`

  ### 3. Format reference genome
  > RUN: `sbatch /scratch/aob2x/dest/DEST/add_DGN_data/getRefGenome.sh` <br/>
  > Check that length of reference geomes are the same as the DGP long files: <br/>
  > `wc -l /scratch/aob2x/dest/referenceGenome/r5/2L.long` <br/>
  > `wc -l /scratch/aob2x/dest/dgn/longData/B_B04_Chr2L.seq.long` <br/>
  > `wc -l /scratch/aob2x/dest/referenceGenome/r5/3L.long` <br/>
  > `wc -l /scratch/aob2x/dest/dgn/longData/B_B04_Chr3L.seq.long` <br/>
  > the reference geome is one line longer than the DGN data but that is due to a trailing empty line. No prob. <br/>

  ### 3. Make per-population SYNC file
  ~~> RUN: `ls /scratch/aob2x/dest/dgn/longData/* | rev | cut -f1 -d'/' | rev | cut -f1 -d'_' | sort | uniq | awk '{print "2L\t"$0"\n2R\t"$0"\n3L\t"$0"\n3R\t"$0"\nX\t"$0"\n"}' > /scratch/aob2x/dest/dgn/pops.delim` <br/>~~
  > RUN: `sbatch /scratch/aob2x/dest/DEST/add_DGN_data/pop_chr_maker.sh`
  > RUN: `nJobs=$( tail -n1 /scratch/aob2x/dest/dgn/pops.delim | cut -f1 )` <br/>
  > RUN: `sbatch --array=1-${nJobs} /scratch/aob2x/dest/DEST/add_DGN_data/makePopSync.sh` <br/>

  ### 4. Identify the positions of all polymorphic sites <br/>
  > RUN: `sbatch --array=1-5 /scratch/aob2x/dest/DEST/add_DGN_data/findAllSites.sh` <br/>

  ### 5. Liftover sites to R6 <br/>
  > Need to install 'liftOver' first from : `wget -P ~ http://hgdownload.soe.ucsc.edu/admin/exe/linux.x86_64/liftOver`
  > RUN: `wget -P /scratch/aob2x/dest/dgn/liftoverChains/ http://hgdownload.soe.ucsc.edu/goldenPath/dm6/liftOver/dm6ToDm3.over.chain.gz` <br/>
  > RUN: `wget -P /scratch/aob2x/dest/dgn/liftoverChains/ http://hgdownload.soe.ucsc.edu/goldenPath/dm3/liftOver/dm3ToDm6.over.chain.gz` <br/>
  > RUN: `sbatch --array=1-5 /scratch/aob2x/dest/DEST/add_DGN_data/liftover_r5_to_r6.sh`

  ### 6. Merge with previous SNP lists <br/>
  > This is a bit of a thorny part. The ultimate goal is to merge the DGN data, with DrosRTEC and DrosEU. <br/>
  > 1. The DrosRTEC sites require the `mel_freqdp_*_042016_Ne_fixed.Rdata` files which were generated by H. Machado as part of [this manuscript](https://www.biorxiv.org/content/10.1101/337543v2.abstract) <br/>.
  > 2. RUN `sbatch /scratch/aob2x/dest/DEST/add_DGN_data/getSNP_list_drosRTEC.sh`
  > The DrosEU sites
  >

http://hgdownload.soe.ucsc.edu/goldenPath/dm3/liftOver/dm3ToDm6.over.chain.gz
ls /scratch/aob2x/dest/dgn/longData/* | rev | cut -f1 -d'/' | rev | cut -f1 -d'_' | awk '{A[$1]++}END{for(i in A)print i,A[i]}' | sort -k2,2n
